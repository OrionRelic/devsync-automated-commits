import httpx
import base64
import numpy as np

# Jina AI API endpoint for CLIP V2
url = "https://api.jina.ai/v1/embeddings"

# Your Jina AI API key (you'll need to get this from Jina AI)
api_key = "jina_878ac90144834e1cbca371b52d8b69fffKVsV7WnVYWiErvcEUrx_Co0z1hq"

# Image data URL
image_url = "data:image/webp;base64,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"
# Text description
text = "Programmation fonctionnelle en Haskell"

# Request embeddings for both image and text
payload = {
    "model": "jina-clip-v2",
    "input": [
        {"image": image_url},
        {"text": text}
    ],
    "normalized": True,  # L2 normalization
    "embedding_type": "float"
}

response = httpx.post(
    url,
    json=payload,
    headers={
        "Authorization": f"Bearer {api_key}",
        "Content-Type": "application/json"
    },
    timeout=30.0
)

response.raise_for_status()
result = response.json()

# Extract embeddings
image_embedding = np.array(result['data'][0]['embedding'])
text_embedding = np.array(result['data'][1]['embedding'])

# Calculate dot product (cosine similarity for normalized vectors)
similarity = np.dot(image_embedding, text_embedding)

print(f"Similarity score: {similarity:.6f}")